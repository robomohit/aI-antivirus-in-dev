#!/usr/bin/env python3
"""
Clean the known_malware.csv file by removing entries for project files
"""
import pandas as pd
import os

def clean_known_malware():
    """Remove project files from known_malware.csv"""
    print("üßπ Cleaning known_malware.csv...")
    
    # Read the current known_malware.csv
    if os.path.exists('known_malware.csv'):
        df = pd.read_csv('known_malware.csv')
        print(f"üìä Original entries: {len(df)}")
        
        # List of project files that should NOT be in known_malware.csv
        project_files = {
            'ai_antivirus.py', 'ai_antivirus_windows.py', 'ai_antivirus_copy.py',
            'config.py', 'utils.py', 'signatures.py', 'gui.py', 'test_suite.py',
            'train_deep_model.py', 'explain_deep_model.py', 'eda_analysis.py',
            'final_test.py', 'test_model_integration.py', 'create_enhanced_dataset.py',
            'setup_windows.bat', 'run_antivirus.bat', 'PROJECT_SUMMARY.md',
            'train_enhanced_model.py', 'train_enhanced_model_windows.py',
            'create_dataset.py', 'create_dataset_windows.py', 'train_model_pytorch.py',
            'train_ultimate_model.py', 'test_scan.py', 'test_malware_signatures.py',
            'run_final_test.py', 'create_eicar_files.py', 'create_fake_malware.py',
            'create_fake_malware_fast.py', 'create_safe_files.py',
            'README_WINDOWS.md', 'WINDOWS_SETUP_GUIDE.md', 'TRIPLE_CHECK_FIXES.md',
            'WINDOWS_ENCODING_FIXES.md', 'malware_dataset.csv'
        }
        
        # Remove entries for project files
        original_count = len(df)
        df_cleaned = df[~df['filename'].isin(project_files)]
        removed_count = original_count - len(df_cleaned)
        
        print(f"üóëÔ∏è Removed {removed_count} project file entries")
        print(f"üìä Remaining entries: {len(df_cleaned)}")
        
        # Save the cleaned file
        df_cleaned.to_csv('known_malware.csv', index=False)
        print("‚úÖ known_malware.csv cleaned successfully!")
        
        # Show what was removed
        removed_files = df[df['filename'].isin(project_files)]['filename'].tolist()
        if removed_files:
            print("\nüóëÔ∏è Removed project files:")
            for file in removed_files:
                print(f"  - {file}")
    else:
        print("‚ùå known_malware.csv not found")

if __name__ == "__main__":
    clean_known_malware()